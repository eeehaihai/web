<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ ¡å›­è®ºå› - é¦–é¡µ</title>
    <link rel="stylesheet" href="style.css">
    <script src="common.js" defer></script> <!-- ä½¿ç”¨ defer -->
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header>
        <div class="container header-content">
            <a href="home.html" class="logo">
                <h1>æ ¡å›­è®ºå›</h1>
            </a>

            <div class="user-actions">
                <!-- æ­¤å¤„ä¼šé€šè¿‡JSåŠ¨æ€æ›´æ–°ç”¨æˆ·ç™»å½•çŠ¶æ€ -->
            </div>
        </div>
    </header>

    <!-- æœç´¢åŒºåŸŸ -->
    <section class="search-section">
        <div class="container search-container">
            <h2>æ¢ç´¢æ ¡å›­é‡Œçš„å¥‡é—»è¶£äº‹ä¸ç”Ÿæ´»ç‚¹æ»´</h2>
            <div class="search-box">
                <!-- æ–°å¢ä¸€ä¸ªåŒ…è£…å™¨ div -->
                <div class="search-input-wrapper">
                    <input type="text" id="searchInput" placeholder="æœç´¢è¯é¢˜ã€å…³é”®è¯...">
                    <!-- å°†å›¾æ ‡æ”¾åœ¨è¿™é‡Œ -->
                    <span class="search-icon">ğŸ”</span>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="container main-content">
        <!-- è¯é¢˜åˆ—è¡¨åŒºåŸŸ -->
        <div class="topic-list">
            <a href="create-topic.html" class="create-topic-btn">å‘å¸ƒæ–°è¯é¢˜</a>

            <div class="topic-filter">
                <div class="filter-options">
                    <a href="#" class="active" data-category="all">å…¨éƒ¨</a>
                    <a href="#" data-category="campus_life">æ ¡å›­ç”Ÿæ´»</a>
                    <a href="#" data-category="study">å­¦ä¹ äº¤æµ</a>
                    <a href="#" data-category="secondhand">äºŒæ‰‹äº¤æ˜“</a>
                    <a href="#" data-category="lost_found">å¤±ç‰©æ‹›é¢†</a>
                </div>
                <div class="sort-options">
                    <a href="#" class="active" data-sort="newest">æœ€æ–°</a>
                    <div class="sort-option-group">
                        <a href="#" data-sort="hottest" id="hottestSortLink">çƒ­é—¨</a>
                        <div class="hottest-tooltip" id="hottestTooltip">
                            <a href="#" data-timerange="1w">ä¸€æ˜ŸæœŸ <span class="checkmark"></span></a>
                            <a href="#" data-timerange="1m">ä¸€ä¸ªæœˆ <span class="checkmark"></span></a>
                            <a href="#" data-timerange="6m">åŠå¹´å†… <span class="checkmark"></span></a>
                            <a href="#" data-timerange="1y">ä¸€å¹´å†… <span class="checkmark"></span></a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯é¢˜åˆ—è¡¨ -->
            <div id="topicListContainer">
                <!-- æ­¤å¤„å°†é€šè¿‡JSåŠ¨æ€åŠ è½½è¯é¢˜åˆ—è¡¨ -->
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- ä¾§è¾¹æ åŒºåŸŸ -->
        <div class="sidebar">
            <!-- çƒ­é—¨åˆ†ç±» -->
            <div class="sidebar-widget">
                <h3>çƒ­é—¨åˆ†ç±» (è¿‘7å¤©)</h3>
                <ul class="category-list" id="categoryCounts">
                    <!-- æ­¤å¤„å°†é€šè¿‡JSåŠ¨æ€åŠ è½½åˆ†ç±»è®¡æ•° -->
                </ul>
            </div>

            <!-- ç”¨æˆ·æ’è¡Œ -->
            <div class="sidebar-widget">
                <h3>æ´»è·ƒç”¨æˆ·æ¦œ (è¿‘7å¤©)</h3>
                <ul class="category-list" id="activeUsers">
                    <!-- æ­¤å¤„å°†é€šè¿‡JSåŠ¨æ€åŠ è½½æ´»è·ƒç”¨æˆ· -->
                </ul>
            </div>

            <!-- æ–°çš„å‹æƒ…é“¾æ¥å’Œç‰ˆæƒä¿¡æ¯å— -->
            <div class="sidebar-widget">
                <h3>å‹æƒ…é“¾æ¥</h3>
                <ul class="info-links-list">
                    <li><a href="https://www.jlu.edu.cn/" target="_blank">å‰æ—å¤§å­¦å®˜ç½‘</a></li>
                    <li><a href="https://jdjyw.jlu.edu.cn/" target="_blank">å‰å¤§å°±ä¸šç½‘</a></li>
                    <li><a href="http://lib.jlu.edu.cn" target="_blank">å‰å¤§å›¾ä¹¦é¦†</a></li>
                    <li><a href="https://ehall.jlu.edu.cn/" target="_blank">ç½‘ä¸ŠåŠäº‹å¤§å…</a></li>
                    <li><a href="contact-team.html">è”ç³»å›¢é˜Ÿ</a></li>
                </ul>
                <div class="widget-copyright-section">
                    Copyright &copy; 2025 æ ¡å›­è®ºå› All Rights Reserved. å‰ICPå¤‡XXXXXXXXå·
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSearchTerm = null; // å…¨å±€å˜é‡å­˜å‚¨å½“å‰æœç´¢è¯
        let currentCategory = 'all';
        let currentSortBy = 'newest';
        let currentTimeRange = '1w';

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // æ›´æ–°å¯¼èˆªæ ç”¨æˆ·çŠ¶æ€
            updateNavUserStatus();

            // åŠ è½½å¹¶æ˜¾ç¤ºè¯é¢˜åˆ—è¡¨ (é»˜è®¤æ’åºå’Œåˆ†ç±»)
            loadTopics(currentCategory, currentSortBy, currentTimeRange, currentSearchTerm);

            // è·å–æ‰€æœ‰å¸–å­æ•°æ®ä¸€æ¬¡ï¼Œç„¶åä¼ é€’ç»™ä¾§è¾¹æ æ›´æ–°å‡½æ•°
            getAllPosts(function(allPostsData) {
                if (allPostsData && allPostsData.length > 0) {
                    updateCategoryCounts(allPostsData);
                    loadActiveUsers(allPostsData);
                } else {
                    // å¤„ç†è·å–æ•°æ®å¤±è´¥æˆ–æ— æ•°æ®çš„æƒ…å†µ
                    document.getElementById('categoryCounts').innerHTML = '<li>æ— æ³•åŠ è½½åˆ†ç±»</li>';
                    document.getElementById('activeUsers').innerHTML = '<li>æ— æ³•åŠ è½½æ´»è·ƒç”¨æˆ·</li>';
                }
            });

            // æ¢å¤æ»šåŠ¨ä½ç½®
            const scrollPosition = sessionStorage.getItem('homeScrollPosition');
            if (scrollPosition) {
                window.scrollTo(0, parseInt(scrollPosition, 10));
                sessionStorage.removeItem('homeScrollPosition'); // ä½¿ç”¨åæ¸…é™¤
            }

            // è®¾ç½®åˆ†ç±»ç­›é€‰ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.filter-options a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    document.querySelectorAll('.filter-options a').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentCategory = this.getAttribute('data-category');
                    loadTopics(currentCategory, currentSortBy, currentTimeRange, currentSearchTerm);
                });
            });

            // è®¾ç½®æ’åºç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.sort-options a[data-sort], .sort-options .sort-option-group a[data-sort]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    const newSortBy = this.getAttribute('data-sort');

                    if (newSortBy === 'hottest') {
                        const activeTimeRangeLink = document.querySelector('.hottest-tooltip a.selected');
                        currentTimeRange = activeTimeRangeLink ? activeTimeRangeLink.getAttribute('data-timerange') : '1w';
                        currentSortBy = 'hottest';

                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        document.getElementById('hottestSortLink').classList.add('active'); // æ¿€æ´»çƒ­é—¨ä¸»æŒ‰é’®

                        if (!activeTimeRangeLink) { // é»˜è®¤é€‰ä¸­â€œä¸€æ˜ŸæœŸâ€
                             const defaultTimeRangeLink = document.querySelector('.hottest-tooltip a[data-timerange="1w"]');
                             if (defaultTimeRangeLink) {
                                 document.querySelectorAll('.hottest-tooltip a .checkmark').forEach(cm => cm.textContent = '');
                                 defaultTimeRangeLink.querySelector('.checkmark').textContent = 'âˆš';
                                 defaultTimeRangeLink.classList.add('selected');
                             }
                        }
                    } else {
                        currentSortBy = newSortBy;
                        // æ¸…é™¤çƒ­é—¨æ—¶é—´èŒƒå›´é€‰æ‹©
                        document.querySelectorAll('.hottest-tooltip a').forEach(item => {
                            item.classList.remove('selected');
                            item.querySelector('.checkmark').textContent = '';
                        });
                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active'); // æ¿€æ´»å½“å‰æ’åºæŒ‰é’®
                    }
                    loadTopics(currentCategory, currentSortBy, currentTimeRange, currentSearchTerm);
                });
            });

            // çƒ­é—¨ç­›é€‰æ‚¬æµ®çª—é€»è¾‘
            const hottestSortLink = document.getElementById('hottestSortLink');
            const hottestTooltip = document.getElementById('hottestTooltip');
            let tooltipTimeout;

            if (hottestSortLink && hottestTooltip) {
                hottestSortLink.addEventListener('mouseenter', () => {
                    clearTimeout(tooltipTimeout);
                    hottestTooltip.style.display = 'block';
                });

                hottestSortLink.addEventListener('mouseleave', () => {
                    tooltipTimeout = setTimeout(() => {
                        hottestTooltip.style.display = 'none';
                    }, 200);
                });

                hottestTooltip.addEventListener('mouseenter', () => {
                    clearTimeout(tooltipTimeout);
                });

                hottestTooltip.addEventListener('mouseleave', () => {
                    tooltipTimeout = setTimeout(() => {
                        hottestTooltip.style.display = 'none';
                    }, 200);
                });

                hottestTooltip.querySelectorAll('a').forEach(timeRangeLink => {
                    timeRangeLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation(); 

                        currentTimeRange = this.getAttribute('data-timerange');
                        currentSortBy = 'hottest'; // ç¡®ä¿æ’åºæ–¹å¼ä¸ºçƒ­é—¨

                        document.querySelectorAll('.sort-options > a, .sort-options > .sort-option-group > a').forEach(item => {
                            item.classList.remove('active');
                        });
                        hottestSortLink.classList.add('active');

                        hottestTooltip.querySelectorAll('a').forEach(item => {
                            item.classList.remove('selected');
                            item.querySelector('.checkmark').textContent = '';
                        });
                        this.classList.add('selected');
                        this.querySelector('.checkmark').textContent = 'âˆš';

                        loadTopics(currentCategory, currentSortBy, currentTimeRange, currentSearchTerm);
                        hottestTooltip.style.display = 'none';
                    });
                });
            }

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨åˆ°æ–°çš„æœç´¢å›¾æ ‡å’Œè¾“å…¥æ¡†
            const searchInput = document.getElementById('searchInput');
            const searchIcon = document.querySelector('.search-icon');

            if (searchIcon) {
                searchIcon.addEventListener('click', searchPosts);
            }

            if (searchInput) {
                searchInput.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // é˜»æ­¢é»˜è®¤çš„è¡¨å•æäº¤è¡Œä¸º
                        searchPosts();
                    }
                });
            }
        });

        // æŸ¥çœ‹è¯é¢˜è¯¦æƒ…
        function viewTopic(id) {
            sessionStorage.setItem('homeScrollPosition', window.scrollY); // ä¿å­˜æ»šåŠ¨ä½ç½®
            window.location.href = `topic-detail.html?id=${id}`;
        }

        // è¯é¢˜å¡ç‰‡åˆ›å»ºå‡½æ•°
        function createTopicCard(post) {
            const topicCard = document.createElement('div');
            topicCard.className = 'topic-card';

            // ä½¿ç”¨é€šç”¨å‡½æ•°æˆªæ–­é•¿æ–‡æœ¬
            const contentPreview = truncateText(post.content);
            const likeButtonClass = post.currentUserLiked ? 'like-btn liked' : 'like-btn';

            // ä½¿ç”¨é€šç”¨å‡½æ•°å¤„ç†HTMLå®‰å…¨
            topicCard.innerHTML = `
                <div class="topic-header">
                    <h3 class="topic-title">${safeHtml(post.title)}</h3>
                    <span class="topic-category">${safeHtml(post.categoryName)}</span>
                </div>
                <div class="topic-meta">
                    <span class="topic-author">${safeHtml(post.author)}</span>
                    <span class="topic-time">${formatTime(post.timestamp)}</span>
                    <span class="topic-views">æµè§ˆ ${post.views}</span>
                    <span class="topic-comments"> è¯„è®º ${post.comments || 0}</span>
                </div>
                <div class="topic-content">${safeHtml(contentPreview)}</div>
                <div class="topic-footer">
                    <div class="topic-stats">
                        <span class="${likeButtonClass}" onclick="likeTopicInList('${post.id}', event)">
                            <span class="like-icon">â¤</span> ç‚¹èµ <span class="like-count">${post.likes || 0}</span>
                        </span>
                        
                    </div>
                    <div class="topic-action">
                        <a href="#" onclick="event.preventDefault(); event.stopPropagation(); viewTopic('${post.id}');">å‚ä¸è®¨è®º</a>
                    </div>
                </div>
            `;

            // å¢åŠ ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½
            topicCard.addEventListener('click', function(e) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯ç‚¹èµæŒ‰é’®ï¼Œä¸è¦è·³è½¬
                if (e.target.closest('.like-btn')) {
                    return;
                }
                viewTopic(post.id);
            });

            return topicCard;
        }

        // åŠ è½½è¯é¢˜åˆ—è¡¨
        function loadTopics(category = 'all', sortBy = 'newest', timeRange = null, searchTerm = null) {
            currentCategory = category; // æ›´æ–°å…¨å±€çŠ¶æ€
            currentSortBy = sortBy;
            currentTimeRange = timeRange;
            // currentSearchTerm is already global

            const topicListContainer = document.getElementById('topicListContainer');
            const searchResultInfoEl = document.querySelector('.search-result-info');
            if (searchResultInfoEl) { // å¦‚æœå­˜åœ¨æ—§çš„æœç´¢ç»“æœä¿¡æ¯ï¼Œå…ˆç§»é™¤
                searchResultInfoEl.remove();
            }
            topicListContainer.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

            let apiUrl = `topics.php?category=${category}&sortBy=${sortBy}`;
            if (sortBy === 'hottest' && timeRange) {
                apiUrl += `&timeRange=${timeRange}`;
            }
            if (searchTerm && searchTerm.trim() !== "") {
                apiUrl += `&searchTerm=${encodeURIComponent(searchTerm.trim())}`;
            }

            sendAjaxRequest('GET', apiUrl, null,
                function(response) {
                    if (response.success) {
                        const posts = response.topics;
                        topicListContainer.innerHTML = ''; // æ¸…ç©ºåŠ è½½æç¤º

                        if (searchTerm && searchTerm.trim() !== "") {
                            const resultInfo = document.createElement('div');
                            resultInfo.className = 'search-result-info';
                            resultInfo.innerHTML = `æ‰¾åˆ° ${posts.length} ä¸ªä¸ "${safeHtml(searchTerm)}" ç›¸å…³çš„è¯é¢˜ (åœ¨å½“å‰åˆ†ç±»ä¸‹)`;
                            topicListContainer.parentNode.insertBefore(resultInfo, topicListContainer);
                        }

                        if (posts.length === 0) {
                            if (!(searchTerm && searchTerm.trim() !== "")) { // ä»…å½“ä¸æ˜¯æœç´¢ç»“æœä¸ºç©ºæ—¶æ˜¾ç¤ºé»˜è®¤æç¤º
                                topicListContainer.innerHTML = '<div class="no-topics">æš‚æ— è¯é¢˜ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªè¯é¢˜å§ï¼</div>';
                            } else if (!document.querySelector('.search-result-info')) { // ç¡®ä¿æœç´¢æç¤ºå·²æ·»åŠ 
                                const resultInfo = document.createElement('div');
                                resultInfo.className = 'search-result-info';
                                resultInfo.innerHTML = `æ²¡æœ‰æ‰¾åˆ°ä¸ "${safeHtml(searchTerm)}" ç›¸å…³çš„è¯é¢˜ (åœ¨å½“å‰åˆ†ç±»ä¸‹)`;
                                topicListContainer.parentNode.insertBefore(resultInfo, topicListContainer);
                            }
                            return;
                        }

                        posts.forEach(post => {
                            const topicCard = createTopicCard(post);
                            topicListContainer.appendChild(topicCard);
                        });
                    } else {
                        topicListContainer.innerHTML = `<div class="no-topics">åŠ è½½è¯é¢˜å¤±è´¥: ${safeHtml(response.message)}</div>`;
                    }
                },
                function() {
                    topicListContainer.innerHTML = '<div class="no-topics">æœåŠ¡å™¨è¿æ¥é”™è¯¯ï¼Œè¯·ç¨åå†è¯•</div>';
                }
            );
        }

        // åœ¨åˆ—è¡¨é¡µç‚¹èµè¯é¢˜
        function likeTopicInList(topicId, event) {
            event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘è¯é¢˜å¡ç‰‡çš„ç‚¹å‡»äº‹ä»¶
            if (!checkLoginRequired()) return;

            const likeBtn = event.currentTarget;
            const likeCountEl = likeBtn.querySelector('.like-count');

            // ä½¿ç”¨é€šç”¨AJAXè¯·æ±‚å‡½æ•°
            sendAjaxRequest('POST', 'like_topic.php', { topicId: topicId },
                function(response) {
                    if (response.success) {
                        // æ›´æ–°æ˜¾ç¤ºçš„ç‚¹èµæ•°
                        likeCountEl.textContent = response.likes;
                        // æ›´æ–°æŒ‰é’®æ ·å¼
                        if (response.isLikedByCurrentUser) {
                            likeBtn.classList.add('liked');
                        } else {
                            likeBtn.classList.remove('liked');
                        }
                    } else {
                        console.error('ç‚¹èµ/å–æ¶ˆç‚¹èµå¤±è´¥:', response.message);
                        alert(response.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                    }
                },
                function() {
                    console.error('ç‚¹èµ/å–æ¶ˆç‚¹èµè¯·æ±‚å¤±è´¥');
                    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•');
                }
            );
        }

        // æ›´æ–°åˆ†ç±»ç»Ÿè®¡ (è¿‘7å¤©)
        function updateCategoryCounts(allPostsData) {
            const categoryCountsEl = document.getElementById('categoryCounts');
            categoryCountsEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨

            const sevenDaysAgo = new Date().getTime() - 7 * 24 * 60 * 60 * 1000;
            const recentPosts = allPostsData.filter(post => post.timestamp >= sevenDaysAgo);

            const categoryCounts = {};
            recentPosts.forEach(post => {
                if (post.category) {
                    categoryCounts[post.category] = (categoryCounts[post.category] || 0) + 1;
                }
            });

            const categoryNames = getCategoryListFromJS(); 

            const sortedCategories = Object.entries(categoryCounts)
                .sort(([, countA], [, countB]) => countB - countA)
                .map(([categoryKey]) => categoryKey);

            if (sortedCategories.length === 0) {
                categoryCountsEl.innerHTML = '<li>æš‚æ— åˆ†ç±»æ•°æ®</li>';
                return;
            }
            
            sortedCategories.forEach(categoryKey => {
                const categoryName = categoryNames[categoryKey] || categoryKey;
                const count = categoryCounts[categoryKey];
                const li = document.createElement('li');
                li.innerHTML = `<a href="#" data-category="${categoryKey}">${safeHtml(categoryName)} <span class="category-count">${count}</span></a>`;
                li.querySelector('a').addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.filter-options a').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('data-category') === categoryKey) {
                            link.classList.add('active');
                        }
                    });
                    loadTopics(categoryKey);
                });
                categoryCountsEl.appendChild(li);
            });
        }

        // åŠ è½½æ´»è·ƒç”¨æˆ· (è¿‘7å¤©ï¼Œæœ€å¤š10ä¸ª)
        function loadActiveUsers(allPostsData) {
            const activeUsersEl = document.getElementById('activeUsers');
            activeUsersEl.innerHTML = ''; // æ¸…ç©ºç°æœ‰åˆ—è¡¨

            const sevenDaysAgo = new Date().getTime() - 7 * 24 * 60 * 60 * 1000;
            const recentPosts = allPostsData.filter(post => post.timestamp >= sevenDaysAgo);

            const userPostCounts = {};
            recentPosts.forEach(post => {
                if (post.author && post.author !== 'åŒ¿åç”¨æˆ·') {
                    userPostCounts[post.author] = (userPostCounts[post.author] || 0) + 1;
                }
            });

            const sortedUsers = Object.entries(userPostCounts)
                .sort(([, countA], [, countB]) => countB - countA)
                .slice(0, 10); // æœ€å¤š10ä¸ªç”¨æˆ·

            if (sortedUsers.length === 0) {
                activeUsersEl.innerHTML = '<li>æš‚æ— æ´»è·ƒç”¨æˆ·</li>';
                return;
            }

            sortedUsers.forEach(([username, postCount]) => {
                const li = document.createElement('li');
                li.innerHTML = `<a href="#">${safeHtml(username)} <span class="category-count">${postCount}</span></a>`;
                activeUsersEl.appendChild(li);
            });
        }

        // æœç´¢å¸–å­
        function searchPosts() {
            const searchTermInput = document.getElementById('searchInput').value;
            currentSearchTerm = searchTermInput.trim(); // æ›´æ–°å…¨å±€æœç´¢è¯

            // å¦‚æœæœç´¢è¯ä¸ºç©ºï¼Œåˆ™åŠ è½½å½“å‰åˆ†ç±»å’Œæ’åºçš„å…¨éƒ¨å†…å®¹
            if (currentSearchTerm === "") {
                const searchResultInfoEl = document.querySelector('.search-result-info');
                if (searchResultInfoEl) {
                    searchResultInfoEl.remove();
                }
            }
            // è°ƒç”¨ loadTopicsï¼Œå®ƒä¼šä½¿ç”¨å…¨å±€çš„ currentCategory, currentSortBy, currentTimeRange å’Œæ–°çš„ currentSearchTerm
            loadTopics(currentCategory, currentSortBy, currentTimeRange, currentSearchTerm);
        }

        // è·å–åˆ†ç±»åˆ—è¡¨çš„è¾…åŠ©å‡½æ•°
        function getCategoryListFromJS() {
            return {
                'campus_life': 'æ ¡å›­ç”Ÿæ´»',
                'study': 'å­¦ä¹ äº¤æµ',
                'secondhand': 'äºŒæ‰‹äº¤æ˜“',
                'lost_found': 'å¤±ç‰©æ‹›é¢†'
            };
        }
    </script>
</body>
</html>
